var I=Object.defineProperty,P=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var v=(r,t,a)=>t in r?I(r,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[t]=a,j=(r,t)=>{for(var a in t||(t={}))H.call(t,a)&&v(r,a,t[a]);if(N)for(var a of N(t))O.call(t,a)&&v(r,a,t[a]);return r},y=(r,t)=>P(r,E(t));var b=(r,t,a)=>new Promise((x,l)=>{var u=c=>{try{i(a.next(c))}catch(e){l(e)}},g=c=>{try{i(a.throw(c))}catch(e){l(e)}},i=c=>c.done?x(c.value):Promise.resolve(c.value).then(u,g);i((a=a.apply(r,t)).next())});import{r as h,j as s,d as w,D as m,g as L}from"./index.js";import{C,b as D,B as S,a as R}from"./card.js";import{C as $,B as K}from"./badge.js";import{R as k,C as z}from"./refresh-cw.js";function X(){const[r,t]=h.useState([{name:"Payments (DataService)",status:"loading"},{name:"Admin Dashboard (DataService)",status:"loading"},{name:"Accountant Dashboard (DataService)",status:"loading"},{name:"System Info (DataService)",status:"loading"},{name:"Branding (settingsAPI)",status:"loading"},{name:"Subjects with Classes (DataService)",status:"loading"}]),[a,x]=h.useState(!1),[l,u]=h.useState(null),g=()=>b(this,null,function*(){x(!0),u(new Date);const e=[...r],n=(o,A)=>b(this,null,function*(){const f=Date.now();try{const d=yield A(),B=Date.now()-f;e[o]=y(j({},e[o]),{status:"ok",latency:B,sample:d})}catch(d){e[o]=y(j({},e[o]),{status:"error",error:d instanceof Error?d.message:String(d),latency:Date.now()-f})}});yield Promise.all([n(0,()=>m.getPayments()),n(1,()=>m.getDashboardData()),n(2,()=>m.getAccountantDashboardData()),n(3,()=>m.getSystemInfo()),n(4,()=>L.getSchoolBranding()),n(5,()=>m.getSubjectsWithClasses())]),t(e),x(!1);const p=e.filter(o=>o.status==="ok").length;w.success(`Health check complete: ${p}/${e.length} services OK`)});h.useEffect(()=>{g()},[]);const i=e=>{switch(e){case"ok":return s.jsx($,{className:"w-5 h-5 text-green-600"});case"error":return s.jsx(z,{className:"w-5 h-5 text-red-600"});case"loading":return s.jsx(k,{className:"w-5 h-5 text-gray-400 animate-spin"})}},c=e=>{const n=e==="ok"?"default":e==="error"?"destructive":"secondary",p=e==="ok"?"OK":e==="error"?"ERROR":"LOADING";return s.jsx(K,{variant:n,children:p})};return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"mb-6",children:[s.jsx("h1",{className:"text-2xl text-gray-900 mb-2",children:"System Health"}),s.jsx("p",{className:"text-gray-600",children:"Quick verification of core DataService and API endpoints"}),l&&s.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last run: ",l.toLocaleString()]})]}),s.jsxs(C,{className:"rounded-xl bg-white border border-gray-200 shadow-sm",children:[s.jsxs(D,{className:"p-5 border-b border-gray-200 flex flex-row items-center justify-between",children:[s.jsx("h3",{className:"text-lg text-gray-900",children:"Health Checks"}),s.jsxs(S,{onClick:g,disabled:a,className:"rounded-xl",children:[s.jsx(k,{className:`w-4 h-4 mr-2 ${a?"animate-spin":""}`}),a?"Running...":"Run Checks"]})]}),s.jsx(R,{className:"p-5 space-y-4",children:r.map((e,n)=>s.jsxs("div",{className:"flex items-center justify-between p-4 border border-gray-200 rounded-lg",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[i(e.status),s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.name}),e.latency!==void 0&&s.jsxs("p",{className:"text-xs text-gray-500",children:[e.latency," ms"]})]})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[c(e.status),e.error&&s.jsx(S,{size:"sm",variant:"ghost",onClick:()=>{navigator.clipboard.writeText(e.error||""),w.info("Error details copied to clipboard")},children:"Copy error"})]})]},n))})]}),s.jsxs(C,{className:"rounded-xl bg-white border border-gray-200 shadow-sm",children:[s.jsx(D,{className:"p-5 border-b border-gray-200",children:s.jsx("h3",{className:"text-lg text-gray-900",children:"Sample Data (last check)"})}),s.jsx(R,{className:"p-5",children:s.jsx("div",{className:"space-y-4",children:r.map((e,n)=>s.jsxs("div",{children:[s.jsx("p",{className:"text-sm font-medium text-gray-700 mb-1",children:e.name}),s.jsx("pre",{className:"text-xs bg-gray-50 border border-gray-200 rounded p-2 overflow-auto max-h-32",children:e.status==="ok"?JSON.stringify(e.sample,null,2):"N/A"})]},n))})})]})]})}export{X as HealthPage};
