var ds=Object.defineProperty,os=Object.defineProperties;var ms=Object.getOwnPropertyDescriptors;var He=Object.getOwnPropertySymbols;var xs=Object.prototype.hasOwnProperty,hs=Object.prototype.propertyIsEnumerable;var Qe=(T,V,B)=>V in T?ds(T,V,{enumerable:!0,configurable:!0,writable:!0,value:B}):T[V]=B,ae=(T,V)=>{for(var B in V||(V={}))xs.call(V,B)&&Qe(T,B,V[B]);if(He)for(var B of He(V))hs.call(V,B)&&Qe(T,B,V[B]);return T},re=(T,V)=>os(T,ms(V));var Fe=(T,V,B)=>new Promise((Z,le)=>{var z=S=>{try{K(B.next(S))}catch(L){le(L)}},ce=S=>{try{K(B.throw(S))}catch(L){le(L)}},K=S=>S.done?Z(S.value):Promise.resolve(S.value).then(z,ce);K((B=B.apply(T,V)).next())});import{c as Ye,b as Se,r as f,j as e,d as W,l as us,k as js,f as bs,a as Ns}from"./index.js";import{C as ne,l as De,m as $e,n as Ue,o as Ge,S as ts,F as ye,f as ps,g as gs,h as Le,i as fe,j as fs,k as ue,E as as,p as vs,L as ws,B as Ze,w as Es,u as ys,v as Bs,N as Ss}from"./NotificationsPage.js";import{C as p,a as g,B as X,b as oe,g as Ee}from"./card.js";import{C as ve,B as ee}from"./badge.js";import{L as de,S as je,a as be,b as Ne,c as pe,d as se,I as we}from"./select.js";import{L as Re}from"./lock.js";import{S as We,a as rs,A as Ke,b as Je,U as _e}from"./avatar.js";import{F as ls,L as Cs,a as cs,T as Fs,S as ns}from"./textarea.js";import{D as Ae}from"./download.js";import{U as As,C as Ve,S as ks}from"./StudentResultSheet.js";import{U as Be}from"./x.js";import{A as ke,B as Te}from"./book-open.js";import{P as Xe,M as es}from"./phone.js";import{C as Is}from"./ChangePasswordPage.js";import"./school.js";/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ts=[["path",{d:"M12 18V5",key:"adv99a"}],["path",{d:"M15 13a4.17 4.17 0 0 1-3-4 4.17 4.17 0 0 1-3 4",key:"1e3is1"}],["path",{d:"M17.598 6.5A3 3 0 1 0 12 5a3 3 0 1 0-5.598 1.5",key:"1gqd8o"}],["path",{d:"M17.997 5.125a4 4 0 0 1 2.526 5.77",key:"iwvgf7"}],["path",{d:"M18 18a4 4 0 0 0 2-7.464",key:"efp6ie"}],["path",{d:"M19.967 17.483A4 4 0 1 1 12 18a4 4 0 1 1-7.967-.517",key:"1gq6am"}],["path",{d:"M6 18a4 4 0 0 1-2-7.464",key:"k1g0md"}],["path",{d:"M6.003 5.125a4 4 0 0 0-2.526 5.77",key:"q97ue3"}]],Ds=Ye("brain",Ts);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $s=[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]],is=Ye("file-spreadsheet",$s);/**
 * @license lucide-react v0.554.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],ss=Ye("heart",Rs);function Ps(){var R,xe;const{currentUser:T,teachers:V,students:B,classes:Z,affectiveDomains:le,psychomotorDomains:z,addAffectiveDomain:ce,updateAffectiveDomain:K,addPsychomotorDomain:S,updatePsychomotorDomain:L,currentTerm:M,currentAcademicYear:$,loadingSessionTerm:ie,sessionTermError:x}=Se(),[C,h]=f.useState(""),[q,D]=f.useState(null),[_,b]=f.useState(!1),[Y,U]=f.useState("affective"),[O,J]=f.useState({attentiveness:{value:0,remark:""},honesty:{value:0,remark:""},neatness:{value:0,remark:""},obedience:{value:0,remark:""},senseOfResponsibility:{value:0,remark:""}}),[F,H]=f.useState({attentionToDirection:{value:0,remark:""},considerateOfOthers:{value:0,remark:""},handwriting:{value:0,remark:""},sports:{value:0,remark:""},verbalFluency:{value:0,remark:""},worksWellIndependently:{value:0,remark:""}}),s=T?V.find(r=>r.id===T.linkedId):null,o=(s==null?void 0:s.isClassTeacher)||!1,A=f.useMemo(()=>s?Z.filter(r=>{var N;return r.classTeacherId===s.id&&((N=r.status)==null?void 0:N.toLowerCase())==="active"}):[],[s,Z]),a=f.useMemo(()=>{if(!C)return[];const r=Z.find(N=>N.id===Number(C));return r!=null&&r.students&&r.students.length>0?r.students.filter(N=>{var u;return((u=N.status)==null?void 0:u.toLowerCase())==="active"}).sort((N,u)=>N.lastName.localeCompare(u.lastName)):B.filter(N=>{var u;return N.classId===Number(C)&&((u=N.status)==null?void 0:u.toLowerCase())==="active"}).sort((N,u)=>N.lastName.localeCompare(u.lastName))},[C,B,Z]),E=r=>r===5?"Excellent":r===4?"Very Good":r===3?"Good":r===2?"Fair":r===1?"Poor":"Not Rated",w=r=>r===5?"bg-[#10B981]":r===4?"bg-[#3B82F6]":r===3?"bg-[#F59E0B]":r===2?"bg-[#F97316]":r===1?"bg-[#EF4444]":"bg-[#9CA3AF]",k=r=>{D(r);const N=le.find(y=>y.studentId===r&&y.classId===Number(C)&&y.term===M&&y.academicYear===$),u=z.find(y=>y.studentId===r&&y.classId===Number(C)&&y.term===M&&y.academicYear===$);J(N?{attentiveness:{value:N.attentiveness,remark:N.attentivenessRemark},honesty:{value:N.honesty,remark:N.honestyRemark},neatness:{value:N.neatness,remark:N.neatnessRemark},obedience:{value:N.obedience,remark:N.obedienceRemark},senseOfResponsibility:{value:N.senseOfResponsibility,remark:N.senseOfResponsibilityRemark}}:{attentiveness:{value:0,remark:""},honesty:{value:0,remark:""},neatness:{value:0,remark:""},obedience:{value:0,remark:""},senseOfResponsibility:{value:0,remark:""}}),H(u?{attentionToDirection:{value:u.attentionToDirection,remark:u.attentionToDirectionRemark},considerateOfOthers:{value:u.considerateOfOthers,remark:u.considerateOfOthersRemark},handwriting:{value:u.handwriting,remark:u.handwritingRemark},sports:{value:u.sports,remark:u.sportsRemark},verbalFluency:{value:u.verbalFluency,remark:u.verbalFluencyRemark},worksWellIndependently:{value:u.worksWellIndependently,remark:u.worksWellIndependentlyRemark}}:{attentionToDirection:{value:0,remark:""},considerateOfOthers:{value:0,remark:""},handwriting:{value:0,remark:""},sports:{value:0,remark:""},verbalFluency:{value:0,remark:""},worksWellIndependently:{value:0,remark:""}}),b(!0)},P=()=>{if(!q||!s)return;const r=Object.values(O).every(t=>t.value>0),N=Object.values(F).every(t=>t.value>0);if(!r||!N){W.error("Please provide ratings for all traits");return}const u=le.find(t=>t.studentId===q&&t.classId===Number(C)&&t.term===M&&t.academicYear===$),y=z.find(t=>t.studentId===q&&t.classId===Number(C)&&t.term===M&&t.academicYear===$),n={studentId:q,classId:Number(C),term:M,academicYear:$,enteredBy:s.id,attentiveness:O.attentiveness.value,attentivenessRemark:O.attentiveness.remark,honesty:O.honesty.value,honestyRemark:O.honesty.remark,neatness:O.neatness.value,neatnessRemark:O.neatness.remark,obedience:O.obedience.value,obedienceRemark:O.obedience.remark,senseOfResponsibility:O.senseOfResponsibility.value,senseOfResponsibilityRemark:O.senseOfResponsibility.remark,enteredDate:new Date().toISOString().split("T")[0]},m={studentId:q,classId:Number(C),term:M,academicYear:$,enteredBy:s.id,attentionToDirection:F.attentionToDirection.value,attentionToDirectionRemark:F.attentionToDirection.remark||E(F.attentionToDirection.value),considerateOfOthers:F.considerateOfOthers.value,considerateOfOthersRemark:F.considerateOfOthers.remark||E(F.considerateOfOthers.value),handwriting:F.handwriting.value,handwritingRemark:F.handwriting.remark||E(F.handwriting.value),sports:F.sports.value,sportsRemark:F.sports.remark||E(F.sports.value),verbalFluency:F.verbalFluency.value,verbalFluencyRemark:F.verbalFluency.remark||E(F.verbalFluency.value),worksWellIndependently:F.worksWellIndependently.value,worksWellIndependentlyRemark:F.worksWellIndependently.remark||E(F.worksWellIndependently.value),enteredDate:new Date().toISOString().split("T")[0]};u?K(u.id,n):ce(n),y?L(y.id,m):S(m);const i=a.find(t=>t.id===q);W.success(`Assessments saved for ${i==null?void 0:i.firstName} ${i==null?void 0:i.lastName}`),b(!1)},te=r=>{const N=le.find(y=>y.studentId===r&&y.classId===Number(C)&&y.term===M&&y.academicYear===$),u=z.find(y=>y.studentId===r&&y.classId===Number(C)&&y.term===M&&y.academicYear===$);return N!==void 0&&u!==void 0};return ie?e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading academic session information..."})]})}):x?e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(ne,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Session Information Required"}),e.jsx("p",{className:"text-gray-600 mb-4",children:x}),e.jsx(X,{onClick:()=>window.location.reload(),children:"Try Again"})]})}):o?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-[#1F2937] mb-2",children:"Affective & Psychomotor Assessment"}),e.jsx("p",{className:"text-[#6B7280]",children:"Evaluate students' behavioral and physical development"})]}),e.jsxs(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-6 border-b border-[#E5E7EB]",children:e.jsx(Ee,{className:"text-[#1F2937]",children:"Select Class"})}),e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx(de,{className:"text-[#1F2937] mb-2 block",children:"Class"}),e.jsxs(je,{value:C,onValueChange:h,children:[e.jsx(be,{className:"rounded-lg border-[#E5E7EB] focus:border-[#2563EB]",children:e.jsx(Ne,{placeholder:"Select your class"})}),e.jsx(pe,{children:A.map(r=>e.jsx(se,{value:r.id.toString(),children:r.name},r.id))})]})]})})]}),C&&a.length>0&&e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsx(p,{className:"rounded-xl bg-gradient-to-br from-[#2563EB] to-[#1D4ED8] text-white border-0 shadow-clinical",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(ss,{className:"w-6 h-6"})})}),e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Students"}),e.jsx("h3",{className:"text-white",children:a.length})]})}),e.jsx(p,{className:"rounded-xl bg-gradient-to-br from-[#10B981] to-[#059669] text-white border-0 shadow-clinical",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(ve,{className:"w-6 h-6"})})}),e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Completed"}),e.jsx("h3",{className:"text-white",children:a.filter(r=>te(r.id)).length})]})}),e.jsx(p,{className:"rounded-xl bg-gradient-to-br from-[#F59E0B] to-[#F4B400] text-white border-0 shadow-clinical",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6"})})}),e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Pending"}),e.jsx("h3",{className:"text-white",children:a.filter(r=>!te(r.id)).length})]})})]}),C&&a.length>0&&e.jsxs(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-6 border-b border-[#E5E7EB]",children:e.jsxs(Ee,{className:"text-[#1F2937]",children:["Students (",a.length,")"]})}),e.jsx(g,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#2563EB] text-white",children:[e.jsx("th",{className:"text-left p-4",children:"#"}),e.jsx("th",{className:"text-left p-4",children:"Student Name"}),e.jsx("th",{className:"text-left p-4",children:"Admission Number"}),e.jsx("th",{className:"text-center p-4",children:"Status"}),e.jsx("th",{className:"text-center p-4",children:"Action"})]})}),e.jsx("tbody",{children:a.map((r,N)=>{const u=te(r.id);return e.jsxs("tr",{className:"border-b border-[#E5E7EB] hover:bg-[#F9FAFB]",children:[e.jsx("td",{className:"p-4 text-[#6B7280]",children:N+1}),e.jsxs("td",{className:"p-4 text-[#1F2937]",children:[r.firstName," ",r.lastName]}),e.jsx("td",{className:"p-4 text-[#6B7280]",children:r.admissionNumber}),e.jsx("td",{className:"p-4 text-center",children:u?e.jsxs(ee,{className:"bg-[#10B981] text-white rounded-full",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),"Complete"]}):e.jsxs(ee,{className:"bg-[#F59E0B] text-white rounded-full",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"Pending"]})}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs(X,{onClick:()=>k(r.id),className:"bg-[#2563EB] hover:bg-[#1D4ED8] text-white rounded-lg shadow-clinical",children:[e.jsx(We,{className:"w-4 h-4 mr-2"}),u?"Edit":"Add"," Assessment"]})})]},r.id)})})]})})})]}),e.jsx(De,{open:_,onOpenChange:b,children:e.jsxs($e,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ue,{children:e.jsx(Ge,{children:q&&a.find(r=>r.id===q)&&e.jsxs(e.Fragment,{children:["Assessment for ",(R=a.find(r=>r.id===q))==null?void 0:R.firstName," ",(xe=a.find(r=>r.id===q))==null?void 0:xe.lastName]})})}),e.jsxs("div",{className:"flex gap-2 border-b border-[#E5E7EB]",children:[e.jsxs("button",{onClick:()=>U("affective"),className:`px-4 py-2 rounded-t-lg transition-all ${Y==="affective"?"bg-[#2563EB] text-white":"bg-[#F9FAFB] text-[#6B7280] hover:bg-[#E5E7EB]"}`,children:[e.jsx(ss,{className:"w-4 h-4 inline mr-2"}),"Affective Domain"]}),e.jsxs("button",{onClick:()=>U("psychomotor"),className:`px-4 py-2 rounded-t-lg transition-all ${Y==="psychomotor"?"bg-[#2563EB] text-white":"bg-[#F9FAFB] text-[#6B7280] hover:bg-[#E5E7EB]"}`,children:[e.jsx(Ds,{className:"w-4 h-4 inline mr-2"}),"Psychomotor Domain"]})]}),Y==="affective"&&e.jsx("div",{className:"space-y-4 mt-4",children:Object.entries(O).map(([r,N])=>e.jsxs("div",{className:"p-4 bg-[#F9FAFB] rounded-lg border border-[#E5E7EB]",children:[e.jsx(de,{className:"text-[#1F2937] mb-3 block capitalize",children:r.replace(/([A-Z])/g," $1").trim()}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-[#6B7280] text-sm mb-2 block",children:"Rating (1-5)"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(u=>e.jsx("button",{onClick:()=>J(y=>re(ae({},y),{[r]:re(ae({},y[r]),{value:u})})),className:`w-12 h-12 rounded-lg flex items-center justify-center transition-all ${N.value===u?`${w(u)} text-white shadow-clinical`:"bg-white border border-[#E5E7EB] text-[#6B7280] hover:border-[#2563EB]"}`,children:u},u))}),N.value>0&&e.jsx("p",{className:"text-sm text-[#6B7280] mt-2",children:E(N.value)})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-[#6B7280] text-sm mb-2 block",children:"Remark (Optional)"}),e.jsx(we,{value:N.remark,onChange:u=>J(y=>re(ae({},y),{[r]:re(ae({},y[r]),{remark:u.target.value})})),placeholder:E(N.value),className:"rounded-lg border-[#E5E7EB] focus:border-[#2563EB]"})]})]})]},r))}),Y==="psychomotor"&&e.jsx("div",{className:"space-y-4 mt-4",children:Object.entries(F).map(([r,N])=>e.jsxs("div",{className:"p-4 bg-[#F9FAFB] rounded-lg border border-[#E5E7EB]",children:[e.jsx(de,{className:"text-[#1F2937] mb-3 block capitalize",children:r.replace(/([A-Z])/g," $1").trim()}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-[#6B7280] text-sm mb-2 block",children:"Rating (1-5)"}),e.jsx("div",{className:"flex gap-2",children:[1,2,3,4,5].map(u=>e.jsx("button",{onClick:()=>H(y=>re(ae({},y),{[r]:re(ae({},y[r]),{value:u})})),className:`w-12 h-12 rounded-lg flex items-center justify-center transition-all ${N.value===u?`${w(u)} text-white shadow-clinical`:"bg-white border border-[#E5E7EB] text-[#6B7280] hover:border-[#2563EB]"}`,children:u},u))}),N.value>0&&e.jsx("p",{className:"text-sm text-[#6B7280] mt-2",children:E(N.value)})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-[#6B7280] text-sm mb-2 block",children:"Remark (Optional)"}),e.jsx(we,{value:N.remark,onChange:u=>H(y=>re(ae({},y),{[r]:re(ae({},y[r]),{remark:u.target.value})})),placeholder:E(N.value),className:"rounded-lg border-[#E5E7EB] focus:border-[#2563EB]"})]})]})]},r))}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6 pt-4 border-t border-[#E5E7EB]",children:[e.jsx(X,{onClick:()=>b(!1),variant:"outline",className:"rounded-lg",children:"Cancel"}),e.jsxs(X,{onClick:P,className:"bg-[#10B981] hover:bg-[#059669] text-white rounded-lg shadow-clinical",children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),"Save Assessment"]})]})]})}),e.jsx(p,{className:"rounded-xl bg-gradient-to-r from-[#3B82F6]/10 to-[#3B82F6]/5 border border-[#3B82F6]/20",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-[#3B82F6] mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-2 text-sm text-[#1F2937]",children:[e.jsx("p",{children:e.jsx("strong",{children:"Assessment Guidelines:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-[#6B7280]",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Rating Scale:"})," 1 (Poor), 2 (Fair), 3 (Good), 4 (Very Good), 5 (Excellent)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Affective Domain:"})," Behavioral traits including attentiveness, honesty, neatness, obedience, and sense of responsibility"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Psychomotor Domain:"})," Physical and cognitive skills including attention to direction, handwriting, sports ability, and verbal fluency"]}),e.jsx("li",{children:"You can optionally add custom remarks for each trait"}),e.jsx("li",{children:"Both affective and psychomotor assessments must be completed before results can be compiled"})]})]})]})})})]}):e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(Re,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-4"}),e.jsx("h3",{className:"text-[#1F2937] mb-2",children:"Class Teacher Only"}),e.jsx("p",{className:"text-[#6B7280]",children:"This feature is only available to Class Teachers. Please contact the administrator if you believe you should have access."})]})})}function Ms(){var y;const{currentUser:T,teachers:V,students:B,classes:Z,getTeacherAssignments:le,scores:z,addScore:ce,updateScore:K,currentTerm:S,currentAcademicYear:L,currentTermId:M,currentSessionId:$,createNotification:ie,getClassRegisteredSubjects:x,subjects:C}=Se(),[h,q]=f.useState(""),[D,_]=f.useState(""),[b,Y]=f.useState({}),[U,O]=f.useState("idle"),[J,F]=f.useState("idle"),[H,s]=f.useState([]),o=T?V.find(n=>n.id===T.linkedId):null,A=o?le(o.id):[];f.useEffect(()=>{(()=>{if(!h){s([]);return}try{const i=x(Number(h),S,L).map(t=>t.subjectId);s(i)}catch(m){console.error("Error loading registered subjects:",m),s([])}})()},[h,S,L,x]);const a=f.useMemo(()=>{const n=new Map;return A.forEach(m=>{n.has(m.classId)||n.set(m.classId,{id:m.classId,name:m.className})}),Array.from(n.values())},[A]),E=f.useMemo(()=>h?A.filter(n=>n.classId===Number(h)&&(H.length===0||H.includes(n.subjectId))):[],[h,A,H]),w=f.useMemo(()=>h?B.filter(n=>n.classId===Number(h)&&n.status==="Active").sort((n,m)=>n.lastName.localeCompare(m.lastName)):[],[h,B]),k=f.useMemo(()=>{if(!D||!h)return[];const n=A.find(m=>m.subjectId===Number(D)&&m.classId===Number(h));return n?z.filter(m=>m.subjectAssignmentId===n.id):[]},[D,h,A,z]),P=k.length>0&&((y=k[0])==null?void 0:y.status)==="Submitted";f.useEffect(()=>{const n={};w.forEach(m=>{var t,l,d;const i=k.find(j=>j.studentId===m.id);n[m.id]={ca1:((t=i==null?void 0:i.ca1)==null?void 0:t.toString())||"",ca2:((l=i==null?void 0:i.ca2)==null?void 0:l.toString())||"",exam:((d=i==null?void 0:i.exam)==null?void 0:d.toString())||""}}),Y(n)},[h,D]);const te=(n,m,i)=>{const t=parseFloat(n)||0,l=parseFloat(m)||0,d=parseFloat(i)||0,j=t+l+d;let I="",v="";return j>=70?(I="A",v="Excellent"):j>=60?(I="B",v="Very Good"):j>=50?(I="C",v="Good"):j>=45?(I="D",v="Fair"):j>=40?(I="E",v="Poor"):(I="F",v="Very Poor"),{total:j,grade:I,remark:v}},R=(n,m,i)=>{const t=parseFloat(i),l=m==="exam"?60:20;if(i&&(isNaN(t)||t<0||t>l)){W.error(`${m.toUpperCase()} must be between 0 and ${l}`);return}Y(d=>re(ae({},d),{[n]:re(ae({},d[n]),{[m]:i})})),O("idle")},xe=()=>{if(!h||!D||!o){W.error("Please select class and subject");return}O("saving");let n=0;const m=A.find(i=>i.subjectId===Number(D)&&i.classId===Number(h));if(!m){W.error("Assignment not found"),O("idle");return}w.forEach(i=>{const t=b[i.id];if(!t||!t.ca1&&!t.ca2&&!t.exam)return;const{total:l,grade:d,remark:j}=te(t.ca1,t.ca2,t.exam),I=k.find(c=>c.studentId===i.id),v={studentId:i.id,subjectAssignmentId:m.id,subjectName:m.subjectName,ca1:parseFloat(t.ca1)||0,ca2:parseFloat(t.ca2)||0,exam:parseFloat(t.exam)||0,total:l,classAverage:0,classMin:0,classMax:0,grade:d,remark:j,subjectTeacher:`${o.firstName} ${o.lastName}`,enteredBy:o.id,enteredDate:new Date().toISOString(),term:S,academicYear:L,status:"Draft"};I?K(I.id,v):ce(v),n++}),O("saved"),W.success(`Draft saved for ${n} students`),setTimeout(()=>O("idle"),2e3)},r=()=>Fe(this,null,function*(){if(!h||!D||!o){W.error("Please select class and subject");return}if(!$||!M){W.error("Active academic session or term is not set. Please contact the administrator.");return}if(w.filter(m=>{const i=b[m.id];return!i||!i.ca1||!i.ca2||!i.exam}).length>0){W.error(`Please enter all scores for all ${w.length} students before submitting`);return}F("submitting");try{const m=A.find(v=>v.subjectId===Number(D)&&v.classId===Number(h));if(!m){W.error("Assignment not found"),F("idle");return}const i=w.map(v=>{const c=b[v.id];return te(c.ca1,c.ca2,c.exam).total}),t=Math.max(...i),l=Math.min(...i),d=i.reduce((v,c)=>v+c,0)/i.length,j=[];w.forEach(v=>{const c=b[v.id],{total:Q,grade:me,remark:ge}=te(c.ca1,c.ca2,c.exam),G=k.find(Ie=>Ie.studentId===v.id),he={studentId:v.id,subjectAssignmentId:m.id,subjectName:m.subjectName,ca1:parseFloat(c.ca1),ca2:parseFloat(c.ca2),exam:parseFloat(c.exam),total:Q,classAverage:Math.round(d*100)/100,classMin:l,classMax:t,grade:me,remark:ge,subjectTeacher:`${o.firstName} ${o.lastName}`,enteredBy:o.id,enteredDate:new Date().toISOString(),term:S,academicYear:L,status:"Submitted"};G?K(G.id,he):ce(he),j.push({student_id:v.id,subject_id:m.subjectId,class_id:m.classId,session_id:$,term_id:M,score:Q,teacher_id:o.id,status:"submitted"})}),j.length>0&&(yield us.bulkCreate(j)),F("submitted"),W.success(`Scores submitted successfully for ${m.className} - ${m.subjectName}`),setTimeout(()=>F("idle"),2e3);const I=Z.find(v=>v.id===Number(h));I&&I.classTeacherId&&ie({title:"New Subject Scores Submitted",message:`${o.firstName} ${o.lastName} has submitted ${m.subjectName} scores for ${m.className}`,type:"info",targetAudience:"teachers",sentBy:T.id})}catch(m){const i=(m==null?void 0:m.message)||"Scores saved locally but failed to sync with server. Please retry later.";console.error("Error submitting scores to backend:",m),W.error(i),F("idle");return}}),N=()=>{if(!h||!D){W.error("Please select class and subject first");return}const n=A.find(d=>d.subjectId===Number(D)&&d.classId===Number(h));if(!n)return;let m=`Student Name,Admission Number,CA1 (Max 20),CA2 (Max 20),Exam (Max 60)
`;w.forEach(d=>{const j=b[d.id]||{ca1:"",ca2:"",exam:""};m+=`${d.firstName} ${d.lastName},${d.admissionNumber},${j.ca1},${j.ca2},${j.exam}
`});const i=new Blob([m],{type:"text/csv"}),t=window.URL.createObjectURL(i),l=document.createElement("a");l.href=t,l.download=`${n.className}_${n.subjectName}_${S}_${L}.csv`,l.click(),W.success("CSV exported successfully!")},u=n=>{var t;const m=(t=n.target.files)==null?void 0:t[0];if(!m)return;const i=new FileReader;i.onload=l=>{var Q;const j=((Q=l.target)==null?void 0:Q.result).split(`
`).filter(me=>me.trim());if(j.length<2){W.error("Invalid CSV file");return}const I=j.slice(1);let v=0,c=0;I.forEach(me=>{const ge=me.split(",");if(ge.length<5)return;const[,G,he,Ie,ze]=ge.map(Ce=>Ce.trim()),qe=w.find(Ce=>Ce.admissionNumber===G);if(!qe){c++;return}const Pe=parseFloat(he),Me=parseFloat(Ie),Oe=parseFloat(ze);if(isNaN(Pe)||Pe<0||Pe>20||isNaN(Me)||Me<0||Me>20||isNaN(Oe)||Oe<0||Oe>60){c++;return}Y(Ce=>re(ae({},Ce),{[qe.id]:{ca1:he,ca2:Ie,exam:ze}})),v++}),v>0&&W.success(`Imported ${v} student scores`),c>0&&W.warning(`${c} entries had errors and were skipped`)},i.readAsText(m),n.target.value=""};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-[#1F2937] mb-2",children:"Enter Scores"}),e.jsx("p",{className:"text-[#6B7280]",children:"Record CA and Exam scores for your assigned subjects"})]}),e.jsxs(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-6 border-b border-[#E5E7EB]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5 text-[#2563EB]"}),e.jsx(Ee,{className:"text-[#1F2937]",children:"Select Class & Subject"})]})}),e.jsxs(g,{className:"p-6",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-[#1F2937] mb-2 block",children:"Class"}),e.jsxs(je,{value:h,onValueChange:n=>{q(n),_("")},children:[e.jsx(be,{className:"rounded-lg border-[#E5E7EB] focus:border-[#2563EB]",children:e.jsx(Ne,{placeholder:"Select a class"})}),e.jsx(pe,{children:a.map(n=>e.jsx(se,{value:n.id.toString(),children:n.name},n.id))})]})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-[#1F2937] mb-2 block",children:"Subject"}),e.jsxs(je,{value:D,onValueChange:_,disabled:!h,children:[e.jsx(be,{className:"rounded-lg border-[#E5E7EB] focus:border-[#2563EB]",children:e.jsx(Ne,{placeholder:"Select a subject"})}),e.jsx(pe,{children:E.length===0?e.jsxs("div",{className:"p-3 text-center text-gray-500",children:[e.jsx(ne,{className:"w-4 h-4 mx-auto mb-1"}),e.jsx("p",{className:"text-sm",children:"No registered subjects for this class"}),e.jsxs("p",{className:"text-xs mt-1",children:["Please contact admin to register subjects for ",S," - ",L]})]}):E.map(n=>e.jsx(se,{value:n.subjectId.toString(),children:n.subjectName},n.id))})]})]})]}),h&&D&&e.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[e.jsxs(X,{onClick:N,variant:"outline",className:"border-[#2563EB] text-[#2563EB] hover:bg-[#2563EB]/10 rounded-xl",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Export Template"]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",accept:".csv",onChange:u,className:"hidden",disabled:P,id:"csv-upload-input"}),e.jsxs(X,{type:"button",variant:"outline",className:"border-[#10B981] text-[#10B981] hover:bg-[#10B981]/10 rounded-xl",disabled:P,onClick:()=>{var n;return(n=document.getElementById("csv-upload-input"))==null?void 0:n.click()},children:[e.jsx(As,{className:"w-4 h-4 mr-2"}),"Import CSV"]})]}),P&&e.jsxs(ee,{className:"bg-[#EF4444] text-white rounded-full flex items-center gap-1",children:[e.jsx(Re,{className:"w-3 h-3"}),"Locked - Already Submitted"]})]})]})]}),h&&D&&w.length>0&&e.jsxs(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-6 border-b border-[#E5E7EB]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(Ee,{className:"text-[#1F2937]",children:["Student Scores (",w.length," students)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(X,{onClick:xe,variant:"outline",className:"border-[#F59E0B] text-[#F59E0B] hover:bg-[#F59E0B]/10 rounded-xl",disabled:P,children:[e.jsx(ts,{className:"w-4 h-4 mr-2"}),U==="saving"?"Saving...":U==="saved"?"Saved!":"Save Draft"]}),e.jsx(X,{onClick:r,className:"bg-[#2563EB] hover:bg-[#1D4ED8] text-white rounded-xl shadow-clinical disabled:opacity-50 disabled:cursor-not-allowed",disabled:P||J==="submitting",children:J==="submitting"?e.jsxs(e.Fragment,{children:[e.jsx(Cs,{className:"w-4 h-4 mr-2 animate-spin"}),"Submitting..."]}):J==="submitted"?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"w-4 h-4 mr-2"}),"Submitted!"]}):e.jsxs(e.Fragment,{children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"Submit Scores"]})})]})]})}),e.jsx(g,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#2563EB] text-white",children:[e.jsx("th",{className:"text-left p-4",children:"#"}),e.jsx("th",{className:"text-left p-4",children:"Student Name"}),e.jsx("th",{className:"text-left p-4",children:"Adm. No"}),e.jsx("th",{className:"text-center p-4",children:"CA1 (20)"}),e.jsx("th",{className:"text-center p-4",children:"CA2 (20)"}),e.jsx("th",{className:"text-center p-4",children:"Exam (60)"}),e.jsx("th",{className:"text-center p-4",children:"Total (100)"}),e.jsx("th",{className:"text-center p-4",children:"Grade"}),e.jsx("th",{className:"text-center p-4",children:"Remark"})]})}),e.jsx("tbody",{children:w.map((n,m)=>{const i=b[n.id]||{ca1:"",ca2:"",exam:""},{total:t,grade:l,remark:d}=te(i.ca1,i.ca2,i.exam),j=i.ca1||i.ca2||i.exam;return e.jsxs("tr",{className:"border-b border-[#E5E7EB] hover:bg-[#F9FAFB]",children:[e.jsx("td",{className:"p-4 text-[#6B7280]",children:m+1}),e.jsxs("td",{className:"p-4 text-[#1F2937]",children:[n.firstName," ",n.lastName]}),e.jsx("td",{className:"p-4 text-[#6B7280]",children:n.admissionNumber}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(we,{type:"number",min:"0",max:"20",value:i.ca1,onChange:I=>R(n.id,"ca1",I.target.value),className:"w-20 mx-auto text-center rounded-lg border-[#E5E7EB] focus:border-[#2563EB]",disabled:P})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(we,{type:"number",min:"0",max:"20",value:i.ca2,onChange:I=>R(n.id,"ca2",I.target.value),className:"w-20 mx-auto text-center rounded-lg border-[#E5E7EB] focus:border-[#2563EB]",disabled:P})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx(we,{type:"number",min:"0",max:"60",value:i.exam,onChange:I=>R(n.id,"exam",I.target.value),className:"w-20 mx-auto text-center rounded-lg border-[#E5E7EB] focus:border-[#2563EB]",disabled:P})}),e.jsx("td",{className:"p-4 text-center",children:e.jsx("span",{className:`${j?"text-[#1F2937]":"text-[#9CA3AF]"}`,children:j?t:"-"})}),e.jsx("td",{className:"p-4 text-center",children:j&&e.jsx(ee,{className:`
                              ${l==="A"?"bg-[#10B981]":""}
                              ${l==="B"?"bg-[#3B82F6]":""}
                              ${l==="C"?"bg-[#F59E0B]":""}
                              ${l==="D"?"bg-[#F97316]":""}
                              ${l==="F"?"bg-[#EF4444]":""}
                              text-white rounded-full
                            `,children:l})}),e.jsx("td",{className:"p-4 text-center text-[#6B7280] text-sm",children:j?d:"-"})]},n.id)})})]})})})]}),h&&D&&w.length===0&&e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(ne,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-4"}),e.jsx("p",{className:"text-[#6B7280]",children:"No students found in this class"})]})}),(!h||!D)&&e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(is,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-4"}),e.jsx("p",{className:"text-[#6B7280] mb-2",children:"Please select a class and subject to begin"}),e.jsx("p",{className:"text-sm text-[#9CA3AF]",children:h&&!D?"Only registered subjects for this class and term will appear in the subject dropdown":"Your assigned classes and registered subjects will appear in the dropdowns above"})]})}),e.jsx(p,{className:"rounded-xl bg-gradient-to-r from-[#3B82F6]/10 to-[#3B82F6]/5 border border-[#3B82F6]/20",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-[#3B82F6] mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-2 text-sm text-[#1F2937]",children:[e.jsx("p",{children:e.jsx("strong",{children:"Score Entry Instructions:"})}),e.jsxs("ul",{className:"list-disc list-inside space-y-1 text-[#6B7280]",children:[e.jsx("li",{children:"CA1 & CA2: Maximum 20 marks each"}),e.jsx("li",{children:"Exam: Maximum 60 marks"}),e.jsx("li",{children:'Use "Export Template" to download CSV for offline entry'}),e.jsx("li",{children:'Fill the CSV and use "Import CSV" to upload scores'}),e.jsx("li",{children:'"Save Draft" allows you to continue later'}),e.jsx("li",{children:'"Submit Scores" locks the scores and notifies the Class Teacher'}),e.jsx("li",{children:"After submission, scores cannot be edited unless Admin unlocks them"})]})]})]})})})]})}function Os(){var n,m,i;const{currentUser:T,teachers:V,students:B,classes:Z,scores:le,affectiveDomains:z,psychomotorDomains:ce,compiledResults:K,compileResult:S,updateCompiledResult:L,currentTerm:M,currentAcademicYear:$,currentTermId:ie,currentSessionId:x,loadingSessionTerm:C,sessionTermError:h,subjectAssignments:q,addNotification:D,schoolSettings:_}=Se(),[b,Y]=f.useState(""),[U,O]=f.useState({}),[J,F]=f.useState(!1),[H,s]=f.useState(null),[o,A]=f.useState([]),a=T?V.find(t=>t.id===T.linkedId):null,E=(a==null?void 0:a.isClassTeacher)||!1,w=f.useMemo(()=>a?Z.filter(t=>{var l;return t.classTeacherId===a.id&&((l=t.status)==null?void 0:l.toLowerCase())==="active"}):[],[a,Z]);f.useEffect(()=>{Fe(this,null,function*(){if(!b){A([]);return}try{const d=yield js.getWithSubjects(Number(b)),j=(d==null?void 0:d.data)||d||null,I=Array.isArray(j==null?void 0:j.subjects)?j.subjects:[];A(I.map(v=>Number(v.id)))}catch(l){console.error("Error loading backend class subjects:",l),A([])}})},[b]);const k=f.useMemo(()=>{if(!b)return[];const t=Z.find(l=>l.id===Number(b));return t!=null&&t.students&&t.students.length>0?t.students.filter(l=>{var d;return((d=l.status)==null?void 0:d.toLowerCase())==="active"}).sort((l,d)=>l.lastName.localeCompare(d.lastName)):B.filter(l=>{var d;return l.classId===Number(b)&&((d=l.status)==null?void 0:d.toLowerCase())==="active"}).sort((l,d)=>l.lastName.localeCompare(d.lastName))},[b,B,Z]),P=f.useMemo(()=>b?q.filter(t=>t.classId===Number(b)&&t.term===M&&t.academicYear===$&&(o.length===0||o.includes(t.subjectId))):[],[b,q,M,$,o]),te=f.useMemo(()=>k.map(t=>{const l=le.filter(G=>G.studentId===t.id&&P.some(he=>he.id===G.subjectAssignmentId)),d=z.find(G=>G.studentId===t.id&&G.classId===Number(b)&&G.term===M&&G.academicYear===$),j=ce.find(G=>G.studentId===t.id&&G.classId===Number(b)&&G.term===M&&G.academicYear===$),I=l.reduce((G,he)=>G+he.total,0),v=l.length>0?Math.round(I/l.length*100)/100:0,c=K.find(G=>G.studentId===t.id&&G.classId===Number(b)&&G.term===M&&G.academicYear===$);let Q="";v>=70?Q="Excellent performance! Keep up the outstanding work.":v>=60?Q="Very good performance. Continue to work hard.":v>=50?Q="Good effort. There is room for improvement.":v>=40?Q="Fair performance. More effort is needed.":v>0&&(Q="Needs serious improvement. Please put in more effort.");const me=U[t.id]||(c==null?void 0:c.classTeacherComment)||Q,ge=l.length===P.length&&d!==void 0&&j!==void 0&&me.trim()!=="";return{student:t,scores:l,affective:d,psychomotor:j,totalScore:I,averageScore:v,subjectsCompleted:l.filter(G=>G.status==="Submitted").length,totalSubjects:P.length,classTeacherComment:me,autoComment:Q,isComplete:ge,existingResult:c}}),[k,le,P,z,ce,U,K,b,M,$]),R=f.useMemo(()=>[...te.filter(d=>d.averageScore>0)].sort((d,j)=>j.averageScore-d.averageScore).map((d,j)=>re(ae({},d),{position:j+1})),[te]),xe=(t,l)=>{O(d=>re(ae({},d),{[t]:l}))},r=(t,l)=>{s(t),O(d=>re(ae({},d),{[t]:l})),F(!0)},N=(t,l)=>{const d=parseInt(l.split("/")[1]),j=parseInt(l.split("/")[0]),I={"First Term":{begin:`${j}-09-01`,end:`${j}-12-15`,nextBegin:`${j+1}-01-08`},"Second Term":{begin:`${j+1}-01-08`,end:`${j+1}-04-12`,nextBegin:`${j+1}-04-28`},"Third Term":{begin:`${j+1}-04-28`,end:`${j+1}-07-28`,nextBegin:`${d}-09-01`}};return I[t]||I["First Term"]},u=()=>Fe(this,null,function*(){var I,v;if(!b||!a){W.error("Please select a class");return}if(!ie||!x){W.error("Active academic session or term is not set. Please contact the administrator.");return}const t=R.filter(c=>!c.isComplete);if(t.length>0){W.error(`${t.length} student(s) have incomplete data. Please ensure all scores, affective/psychomotor assessments, and comments are entered.`);return}const l=R.reduce((c,Q)=>c+Q.averageScore,0)/R.length,d=N(M||"First Term",$||"2024/2025"),j=R.map(c=>({student_id:c.student.id,times_present:0,times_absent:0,total_attendance_days:0,term_begin:d.begin,term_end:d.end,next_term_begin:d.nextBegin,class_teacher_name:`${a.firstName} ${a.lastName}`,class_teacher_comment:c.classTeacherComment,principal_name:(_==null?void 0:_.principalName)||"Principal",principal_comment:"",principal_signature:(_==null?void 0:_.principalSignature)||""}));try{yield bs.compile({class_id:Number(b),term_id:ie,session_id:x,students_meta:j}),R.forEach(c=>{const Q=K.find(ge=>ge.studentId===c.student.id),me={studentId:c.student.id,classId:Number(b),term:M||"",academicYear:$||"",scores:c.scores,affective:c.affective||null,psychomotor:c.psychomotor||null,totalScore:c.totalScore,averageScore:c.averageScore,classAverage:l,position:c.position,totalStudents:R.length,timesPresent:0,timesAbsent:0,totalAttendanceDays:0,termBegin:d.begin,termEnd:d.end,nextTermBegin:d.nextBegin,classTeacherName:`${a.firstName} ${a.lastName}`,classTeacherComment:c.classTeacherComment||"",principalName:(_==null?void 0:_.principalName)||"Principal",principalComment:"",principalSignature:(_==null?void 0:_.principalSignature)||"",compiledBy:a.id,compiledDate:new Date().toISOString(),status:"Submitted",approvedBy:null,approvedDate:null,rejectionReason:null};Q?L(Q.id,me):S(me)}),D({title:"Class Results Submitted for Approval",message:`${a.firstName} ${a.lastName} has submitted compiled results for ${(I=Z.find(c=>c.id===Number(b)))==null?void 0:I.name} - ${M||"Unknown"} ${$||"Unknown"}`,type:"info",targetAudience:"all",senderId:T.id,senderName:T.name,senderRole:"teacher",priority:"medium"}),W.success(`Results submitted successfully for ${R.length} students`)}catch(c){console.error("Error submitting results:",c);const Q=((v=c==null?void 0:c.data)==null?void 0:v.message)||(c==null?void 0:c.message);(c==null?void 0:c.status)===400&&typeof Q=="string"&&Q.toLowerCase().includes("results already compiled")?W.error("Results have already been compiled for this class, term, and session. Please contact the administrator if you need changes."):Q?W.error(Q):W.error("Failed to submit results. Please try again.")}}),y=()=>{var v;if(!b){W.error("Please select a class");return}const t=((v=Z.find(c=>c.id===Number(b)))==null?void 0:v.name)||"Class";let l=`${t} - ${M} ${$}

`;l+=`Student Name,Admission Number,Subjects Completed,Total Score,Average,Position,Status
`,R.forEach(c=>{l+=`${c.student.firstName} ${c.student.lastName},`,l+=`${c.student.admissionNumber},`,l+=`${c.subjectsCompleted}/${c.totalSubjects},`,l+=`${c.totalScore},`,l+=`${c.averageScore},`,l+=`${c.position},`,l+=`${c.isComplete?"Complete":"Incomplete"}
`});const d=new Blob([l],{type:"text/csv"}),j=window.URL.createObjectURL(d),I=document.createElement("a");I.href=j,I.download=`${t}_Summary_${M||"Unknown"}_${$||"Unknown"}.csv`,I.click(),W.success("Summary exported successfully!")};return C?e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading academic session information..."})]})}):h?e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(ne,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Session Information Required"}),e.jsx("p",{className:"text-gray-600 mb-4",children:h}),e.jsx(X,{onClick:()=>window.location.reload(),children:"Try Again"})]})}):E?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-[#1F2937] mb-2",children:"Compile Results"}),e.jsx("p",{className:"text-[#6B7280]",children:"Review and finalize term results for your class"})]}),e.jsxs(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-6 border-b border-[#E5E7EB]",children:e.jsx(Ee,{className:"text-[#1F2937]",children:"Select Class"})}),e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(de,{className:"text-[#1F2937] mb-2 block",children:"Class"}),e.jsxs(je,{value:b,onValueChange:Y,children:[e.jsx(be,{className:"rounded-lg border-[#E5E7EB] focus:border-[#2563EB]",children:e.jsx(Ne,{placeholder:"Select your class"})}),e.jsx(pe,{children:w.map(t=>e.jsx(se,{value:t.id.toString(),children:t.name},t.id))})]})]}),b&&e.jsx("div",{className:"flex items-end",children:e.jsxs(X,{onClick:y,variant:"outline",className:"border-[#2563EB] text-[#2563EB] hover:bg-[#2563EB]/10 rounded-xl",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Export Summary"]})})]})})]}),b&&R.length>0&&e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsx(p,{className:"rounded-xl bg-gradient-to-br from-[#2563EB] to-[#1D4ED8] text-white border-0 shadow-clinical",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(ye,{className:"w-6 h-6"})})}),e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Total Students"}),e.jsx("h3",{className:"text-white",children:R.length})]})}),e.jsx(p,{className:"rounded-xl bg-gradient-to-br from-[#10B981] to-[#059669] text-white border-0 shadow-clinical",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(ve,{className:"w-6 h-6"})})}),e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Complete"}),e.jsx("h3",{className:"text-white",children:R.filter(t=>t.isComplete).length})]})}),e.jsx(p,{className:"rounded-xl bg-gradient-to-br from-[#F59E0B] to-[#F4B400] text-white border-0 shadow-clinical",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(ne,{className:"w-6 h-6"})})}),e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Incomplete"}),e.jsx("h3",{className:"text-white",children:R.filter(t=>!t.isComplete).length})]})}),e.jsx(p,{className:"rounded-xl bg-gradient-to-br from-[#8B5CF6] to-[#7C3AED] text-white border-0 shadow-clinical",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center",children:e.jsx(cs,{className:"w-6 h-6"})})}),e.jsx("p",{className:"text-white/80 text-sm mb-1",children:"Class Average"}),e.jsxs("h3",{className:"text-white",children:[R.length>0?(R.reduce((t,l)=>t+l.averageScore,0)/R.length).toFixed(1):"0","%"]})]})})]}),b&&R.length>0&&e.jsxs(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-6 border-b border-[#E5E7EB]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(Ee,{className:"text-[#1F2937]",children:"Student Results Overview"}),e.jsxs(X,{onClick:u,className:"bg-[#10B981] hover:bg-[#059669] text-white rounded-xl shadow-clinical",disabled:R.some(t=>!t.isComplete),children:[e.jsx(rs,{className:"w-4 h-4 mr-2"}),"Submit to Admin"]})]})}),e.jsx(g,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-[#2563EB] text-white",children:[e.jsx("th",{className:"text-left p-4",children:"Position"}),e.jsx("th",{className:"text-left p-4",children:"Student Name"}),e.jsx("th",{className:"text-center p-4",children:"Subjects"}),e.jsx("th",{className:"text-center p-4",children:"Total"}),e.jsx("th",{className:"text-center p-4",children:"Average"}),e.jsx("th",{className:"text-center p-4",children:"Affective"}),e.jsx("th",{className:"text-center p-4",children:"Psychomotor"}),e.jsx("th",{className:"text-center p-4",children:"Comment"}),e.jsx("th",{className:"text-center p-4",children:"Status"})]})}),e.jsx("tbody",{children:R.map(t=>e.jsxs("tr",{className:"border-b border-[#E5E7EB] hover:bg-[#F9FAFB]",children:[e.jsx("td",{className:"p-4 text-center",children:e.jsx(ee,{className:"bg-[#8B5CF6] text-white rounded-full",children:t.position})}),e.jsxs("td",{className:"p-4 text-[#1F2937]",children:[t.student.firstName," ",t.student.lastName]}),e.jsxs("td",{className:"p-4 text-center text-[#6B7280]",children:[t.subjectsCompleted,"/",t.totalSubjects]}),e.jsx("td",{className:"p-4 text-center text-[#1F2937]",children:t.totalScore}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs("span",{className:`
                          ${t.averageScore>=70?"text-[#10B981]":""}
                          ${t.averageScore>=50&&t.averageScore<70?"text-[#F59E0B]":""}
                          ${t.averageScore<50?"text-[#EF4444]":""}
                        `,children:[t.averageScore,"%"]})}),e.jsx("td",{className:"p-4 text-center",children:t.affective?e.jsx(ve,{className:"w-5 h-5 text-[#10B981] mx-auto"}):e.jsx(ne,{className:"w-5 h-5 text-[#F59E0B] mx-auto"})}),e.jsx("td",{className:"p-4 text-center",children:t.psychomotor?e.jsx(ve,{className:"w-5 h-5 text-[#10B981] mx-auto"}):e.jsx(ne,{className:"w-5 h-5 text-[#F59E0B] mx-auto"})}),e.jsx("td",{className:"p-4 text-center",children:e.jsxs(X,{onClick:()=>r(t.student.id,t.classTeacherComment),variant:"outline",size:"sm",className:"border-[#2563EB] text-[#2563EB] hover:bg-[#2563EB]/10 rounded-lg",children:[e.jsx(We,{className:"w-3 h-3 mr-1"}),t.classTeacherComment?"Edit":"Add"]})}),e.jsx("td",{className:"p-4 text-center",children:t.isComplete?e.jsxs(ee,{className:"bg-[#10B981] text-white rounded-full",children:[e.jsx(ve,{className:"w-3 h-3 mr-1"}),"Complete"]}):e.jsxs(ee,{className:"bg-[#F59E0B] text-white rounded-full",children:[e.jsx(ne,{className:"w-3 h-3 mr-1"}),"Incomplete"]})})]},t.student.id))})]})})})]}),b&&R.length===0&&e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(ne,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-4"}),e.jsx("p",{className:"text-[#6B7280]",children:"No students found in this class"})]})}),!b&&e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(ye,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-4"}),e.jsx("p",{className:"text-[#6B7280] mb-2",children:"Select a class to view and compile results"}),e.jsx("p",{className:"text-sm text-[#9CA3AF]",children:"You can only compile results for classes where you are the Class Teacher"})]})}),e.jsx(De,{open:J,onOpenChange:F,children:e.jsxs($e,{className:"max-w-2xl",children:[e.jsx(Ue,{children:e.jsx(Ge,{children:"Class Teacher Comment"})}),e.jsx("div",{className:"space-y-4",children:H&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsxs(de,{className:"text-[#1F2937] mb-2 block",children:["Student: ",(n=R.find(t=>t.student.id===H))==null?void 0:n.student.firstName," ",(m=R.find(t=>t.student.id===H))==null?void 0:m.student.lastName]}),e.jsxs("div",{className:"p-4 bg-[#F9FAFB] rounded-lg border border-[#E5E7EB] mb-4",children:[e.jsx("p",{className:"text-sm text-[#6B7280] mb-2",children:"Suggested Comment:"}),e.jsx("p",{className:"text-[#1F2937]",children:(i=R.find(t=>t.student.id===H))==null?void 0:i.autoComment})]})]}),e.jsxs("div",{children:[e.jsx(de,{className:"text-[#1F2937] mb-2 block",children:"Your Comment"}),e.jsx(Fs,{value:U[H]||"",onChange:t=>xe(H,t.target.value),placeholder:"Enter your comment for this student...",className:"min-h-32 rounded-lg border-[#E5E7EB] focus:border-[#2563EB]"})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(X,{onClick:()=>{var t;xe(H,((t=R.find(l=>l.student.id===H))==null?void 0:t.autoComment)||"")},variant:"outline",className:"rounded-lg",children:"Use Suggested"}),e.jsx(X,{onClick:()=>F(!1),className:"bg-[#2563EB] hover:bg-[#1D4ED8] text-white rounded-lg",children:"Save Comment"})]})]})})]})}),e.jsx(p,{className:"rounded-xl bg-gradient-to-r from-[#F59E0B]/10 to-[#F59E0B]/5 border border-[#F59E0B]/20",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ne,{className:"w-5 h-5 text-[#F59E0B] mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"space-y-2 text-sm text-[#1F2937]",children:[e.jsx("p",{children:e.jsx("strong",{children:"Result Compilation Workflow:"})}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1 text-[#6B7280]",children:[e.jsx("li",{children:"Verify all subject teachers have submitted scores for all students"}),e.jsx("li",{children:"Ensure affective and psychomotor assessments are completed (use Affective & Psychomotor page)"}),e.jsx("li",{children:"Add or edit class teacher comments for each student"}),e.jsx("li",{children:"Review the class rankings and averages"}),e.jsx("li",{children:"Submit to Admin for final approval and publishing to parents"})]})]})]})})})]}):e.jsx(p,{className:"rounded-xl bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx(Re,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-4"}),e.jsx("h3",{className:"text-[#1F2937] mb-2",children:"Class Teacher Only"}),e.jsx("p",{className:"text-[#6B7280]",children:"This feature is only available to Class Teachers. Please contact the administrator if you believe you should have access."})]})})}function Ls(){var H;const{classes:T,students:V,parents:B,currentUser:Z,teachers:le,getTeacherAssignments:z,compiledResults:ce}=Se(),[K,S]=f.useState(""),[L,M]=f.useState(((H=T[0])==null?void 0:H.id)||1),[$,ie]=f.useState("all"),[x,C]=f.useState(null),h=Z?le.find(s=>s.id===Z.linkedId):null,D=(h?z(h.id):[]).map(s=>s.classId),_=T.filter(s=>D.includes(s.id)||(h==null?void 0:h.isClassTeacher)),b=T.find(s=>s.id===L)||T[0],Y=f.useMemo(()=>V.filter(s=>s.classId===L&&s.status==="Active").map((s,o)=>{const A=B.find(k=>k.id===s.parentId),a=ce.filter(k=>k.studentId===s.id&&k.status==="Approved"),E=a.length>0?a.reduce((k,P)=>k+P.averageScore,0)/a.length:0,w=a.length>0?Math.round(a.reduce((k,P)=>{const te=P.totalAttendanceDays>0?P.totalAttendanceDays:P.timesPresent+P.timesAbsent;return te>0?k+P.timesPresent/te*100:k},0)/a.length):0;return re(ae({},s),{parentName:A?`${A.firstName} ${A.lastName}`:"N/A",parentPhone:(A==null?void 0:A.phone)||"N/A",parentEmail:(A==null?void 0:A.email)||"N/A",attendance:w,averageScore:E||0,position:o+1})}).sort((s,o)=>o.averageScore-s.averageScore).map((s,o)=>re(ae({},s),{position:o+1})),[V,L,B,ce]),U=Y.filter(s=>{const A=`${s.firstName} ${s.lastName}`.toLowerCase().includes(K.toLowerCase())||s.admissionNumber.toLowerCase().includes(K.toLowerCase())||s.parentName.toLowerCase().includes(K.toLowerCase()),a=$==="all"||s.gender===$;return A&&a}),O={totalStudents:Y.length,maleCount:Y.filter(s=>s.gender==="Male").length,femaleCount:Y.filter(s=>s.gender==="Female").length,averageAttendance:Y.reduce((s,o)=>s+o.attendance,0)/Y.length,averageScore:Y.reduce((s,o)=>s+o.averageScore,0)/Y.length},J=s=>s?s.split(" ").map(o=>o[0]).join("").toUpperCase():"??",F=()=>{const s=["Student ID","Name","Gender","DOB","Parent Name","Parent Phone","Parent Email","Attendance %","Average Score","Position"],o=U.map(k=>[k.admissionNumber,`${k.firstName} ${k.lastName}`,k.gender,new Date(k.dateOfBirth).toLocaleDateString("en-GB"),k.parentName,k.parentPhone,k.parentEmail,k.attendance,k.averageScore,k.position]),A=[s,...o].map(k=>k.join(",")).join(`
`),a=new Blob([A],{type:"text/csv"}),E=URL.createObjectURL(a),w=document.createElement("a");w.href=E,w.download=`${(b==null?void 0:b.name)||"class"}-class-list-${new Date().toISOString().split("T")[0]}.csv`,w.click()};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-[#0A2540] mb-2",children:["Class List - ",(b==null?void 0:b.name)||"Select Class"]}),e.jsx("p",{className:"text-gray-600",children:"Manage and view your class students"})]}),e.jsxs(je,{value:L.toString(),onValueChange:s=>M(Number(s)),children:[e.jsx(be,{className:"w-48 border-[#0A2540]/20 rounded-xl",children:e.jsx(Ne,{})}),e.jsx(pe,{children:_.length>0?_.map(s=>e.jsx(se,{value:s.id.toString(),children:s.name},s.id)):T.map(s=>e.jsx(se,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx(p,{className:"border-[#0A2540]/10",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-1",children:"Total Students"}),e.jsx("p",{className:"text-[#0A2540]",children:O.totalStudents})]}),e.jsx("div",{className:"bg-blue-100 p-3 rounded-xl",children:e.jsx(Be,{className:"w-6 h-6 text-blue-600"})})]})})}),e.jsx(p,{className:"border-[#0A2540]/10",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-1",children:"Male"}),e.jsx("p",{className:"text-[#0A2540]",children:O.maleCount})]}),e.jsx("div",{className:"bg-indigo-100 p-3 rounded-xl",children:e.jsx(Be,{className:"w-6 h-6 text-indigo-600"})})]})})}),e.jsx(p,{className:"border-[#0A2540]/10",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-1",children:"Female"}),e.jsx("p",{className:"text-[#0A2540]",children:O.femaleCount})]}),e.jsx("div",{className:"bg-pink-100 p-3 rounded-xl",children:e.jsx(Be,{className:"w-6 h-6 text-pink-600"})})]})})}),e.jsx(p,{className:"border-[#0A2540]/10",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-1",children:"Avg Attendance"}),e.jsxs("p",{className:"text-[#0A2540]",children:[O.averageAttendance.toFixed(1),"%"]})]}),e.jsx("div",{className:"bg-green-100 p-3 rounded-xl",children:e.jsx(cs,{className:"w-6 h-6 text-green-600"})})]})})}),e.jsx(p,{className:"border-[#0A2540]/10",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm mb-1",children:"Class Average"}),e.jsxs("p",{className:"text-[#0A2540]",children:[O.averageScore.toFixed(1),"%"]})]}),e.jsx("div",{className:"bg-yellow-100 p-3 rounded-xl",children:e.jsx(ke,{className:"w-6 h-6 text-yellow-600"})})]})})})]}),e.jsx(p,{className:"border-[#0A2540]/10",children:e.jsx(g,{className:"p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(we,{type:"text",placeholder:"Search by name, ID, or parent...",value:K,onChange:s=>S(s.target.value),className:"pl-10 border-[#0A2540]/20 focus:border-[#FFD700] rounded-xl"})]}),e.jsxs(je,{value:$,onValueChange:ie,children:[e.jsx(be,{className:"border-[#0A2540]/20 rounded-xl",children:e.jsx(Ne,{placeholder:"Gender"})}),e.jsxs(pe,{children:[e.jsx(se,{value:"all",children:"All Genders"}),e.jsx(se,{value:"Male",children:"Male"}),e.jsx(se,{value:"Female",children:"Female"})]})]}),e.jsxs(X,{onClick:F,className:"bg-[#0A2540] hover:bg-[#0A2540]/90 text-white rounded-xl",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Export Class List"]})]})})}),e.jsxs(p,{className:"border-[#0A2540]/10",children:[e.jsx(oe,{className:"border-b border-[#0A2540]/10 bg-[#0A2540]/5",children:e.jsxs(Ee,{className:"text-[#0A2540]",children:["Students (",U.length,")"]})}),e.jsx(g,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(ps,{children:[e.jsx(gs,{children:e.jsxs(Le,{className:"bg-[#0A2540]/5",children:[e.jsx(fe,{className:"text-[#0A2540]",children:"Position"}),e.jsx(fe,{className:"text-[#0A2540]",children:"Student"}),e.jsx(fe,{className:"text-[#0A2540]",children:"Gender"}),e.jsx(fe,{className:"text-[#0A2540]",children:"Parent/Guardian"}),e.jsx(fe,{className:"text-[#0A2540]",children:"Contact"}),e.jsx(fe,{className:"text-[#0A2540]",children:"Attendance"}),e.jsx(fe,{className:"text-[#0A2540]",children:"Average Score"}),e.jsx(fe,{className:"text-[#0A2540]",children:"Actions"})]})}),e.jsx(fs,{children:U.length===0?e.jsx(Le,{children:e.jsx(ue,{colSpan:8,className:"text-center py-8 text-gray-500",children:"No students found"})}):U.map(s=>e.jsxs(Le,{className:"hover:bg-[#0A2540]/5",children:[e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.position<=3&&e.jsx(ke,{className:`w-4 h-4 ${s.position===1?"text-yellow-500":s.position===2?"text-gray-400":"text-orange-600"}`}),e.jsx("span",{className:"text-[#0A2540]",children:s.position})]})}),e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ke,{className:"h-10 w-10 bg-[#0A2540] text-white",children:e.jsx(Je,{className:"bg-[#0A2540] text-white",children:J(`${s.firstName} ${s.lastName}`)})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-[#0A2540]",children:[s.firstName," ",s.lastName]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.admissionNumber})]})]})}),e.jsx(ue,{children:e.jsx(ee,{variant:s.gender==="Male"?"default":"secondary",className:"rounded-xl",children:s.gender})}),e.jsx(ue,{children:e.jsx("div",{children:e.jsx("p",{className:"text-[#0A2540]",children:s.parentName})})}),e.jsx(ue,{children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(Xe,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600",children:s.parentPhone})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(es,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-600 truncate max-w-[200px]",children:s.parentEmail})]})]})}),e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-gray-200 rounded-full h-2 w-16",children:e.jsx("div",{className:`h-2 rounded-full ${s.attendance>=90?"bg-green-500":s.attendance>=75?"bg-yellow-500":"bg-red-500"}`,style:{width:`${s.attendance}%`}})}),e.jsxs("span",{className:"text-sm text-gray-600",children:[s.attendance,"%"]})]})}),e.jsx(ue,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-[#0A2540]",children:[s.averageScore.toFixed(1),"%"]}),e.jsx(ee,{className:`rounded-xl ${s.averageScore>=70?"bg-green-100 text-green-800":s.averageScore>=50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:s.averageScore>=70?"Excellent":s.averageScore>=50?"Good":"Needs Improvement"})]})}),e.jsx(ue,{children:e.jsx(X,{variant:"ghost",size:"sm",onClick:()=>C(s),className:"text-[#0A2540] hover:text-[#FFD700] hover:bg-[#FFD700]/10 rounded-xl",children:e.jsx(as,{className:"w-4 h-4"})})})]},s.id))})]})})})]}),e.jsx(De,{open:!!x,onOpenChange:()=>C(null),children:e.jsxs($e,{className:"max-w-2xl rounded-xl",children:[e.jsxs(Ue,{children:[e.jsx(Ge,{className:"text-[#0A2540]",children:"Student Details"}),e.jsxs(vs,{children:["Complete information for ",x&&`${x.firstName} ${x.lastName}`]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(Ke,{className:"h-20 w-20 bg-[#0A2540] text-white text-xl",children:e.jsx(Je,{className:"bg-[#0A2540] text-white",children:x&&J(`${x.firstName} ${x.lastName}`)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-[#0A2540]",children:x&&`${x.firstName} ${x.lastName}`}),e.jsx("p",{className:"text-gray-600",children:x==null?void 0:x.admissionNumber}),e.jsx(ee,{variant:"secondary",className:"mt-1 rounded-xl",children:x==null?void 0:x.gender})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 bg-gray-50 p-4 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Date of Birth"}),e.jsx("p",{className:"text-[#0A2540]",children:x&&new Date(x.dateOfBirth).toLocaleDateString("en-GB")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Academic Year"}),e.jsx("p",{className:"text-[#0A2540]",children:(x==null?void 0:x.academicYear)||"2024/2025"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Class Position"}),e.jsxs("p",{className:"text-[#0A2540]",children:[x==null?void 0:x.position," / ",Y.length]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Status"}),e.jsx(ee,{className:"bg-green-100 text-green-800 rounded-xl",children:"Active"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-[#0A2540]",children:"Performance"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Average Score"}),e.jsxs("p",{className:"text-[#0A2540] text-xl",children:[x==null?void 0:x.averageScore.toFixed(1),"%"]})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-xl",children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Attendance Rate"}),e.jsxs("p",{className:"text-[#0A2540] text-xl",children:[x==null?void 0:x.attendance,"%"]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"text-[#0A2540]",children:"Parent/Guardian Information"}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-xl space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Name"}),e.jsx("p",{className:"text-[#0A2540]",children:x==null?void 0:x.parentName})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Phone"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-[#0A2540]",children:x==null?void 0:x.parentPhone})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(es,{className:"w-4 h-4 text-gray-400"}),e.jsx("p",{className:"text-[#0A2540]",children:x==null?void 0:x.parentEmail})]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Class"}),e.jsx("p",{className:"text-[#0A2540]",children:x==null?void 0:x.className})]})]})]})]})]})})]})}function _s(){var o,A;const{currentUser:T,teachers:V,getTeacherAssignments:B,compiledResults:Z,fetchCompiledResults:le,students:z,subjectAssignments:ce,scores:K}=Se(),[S,L]=f.useState("all"),[M,$]=f.useState("all"),[ie,x]=f.useState("all"),[C,h]=f.useState(""),[q,D]=f.useState(null);f.useEffect(()=>{le().catch(()=>{})},[]);const _=T?V.find(a=>a.id===T.linkedId):null,b=_?B(_.id):[],Y=Array.from(new Set(b.map(a=>a.className))),U=Z.filter(a=>{const E=z.find(w=>w.id===a.studentId);return E&&Y.includes(E.className)}),J=[...U.filter(a=>{const E=z.find(w=>w.id===a.studentId);if(!E||S!=="all"&&E.className!==S||M!=="all"&&a.term!==M||ie!=="all"&&a.status!==ie)return!1;if(C){const w=C.toLowerCase(),k=`${E.firstName} ${E.lastName}`.toLowerCase(),P=E.admissionNumber.toLowerCase();if(!k.includes(w)&&!P.includes(w))return!1}return!0})].sort((a,E)=>new Date(E.compiledDate).getTime()-new Date(a.compiledDate).getTime()),F=a=>{if(!z.find(P=>P.id===a.studentId))return;const w=K.filter(P=>{if(P.studentId!==a.studentId)return!1;const te=ce.find(N=>N.id===P.subjectAssignmentId);if(!te)return!1;const R=te.term===a.term,xe=te.academicYear===a.academicYear,r=P.status==="Submitted";return R&&xe&&r}),k=re(ae({},a),{scores:w});D(k)},H=a=>{F(a),setTimeout(()=>{window.print()},500)},s=a=>{switch(a){case"Approved":return e.jsx(ee,{className:"bg-[#10B981] text-white border-0 rounded-full",children:"Approved"});case"Submitted":return e.jsx(ee,{className:"bg-[#F59E0B] text-white border-0 rounded-full",children:"Pending Approval"});case"Draft":return e.jsx(ee,{className:"bg-[#6B7280] text-white border-0 rounded-full",children:"Draft"});case"Rejected":return e.jsx(ee,{className:"bg-[#EF4444] text-white border-0 rounded-full",children:"Rejected"});default:return e.jsx(ee,{className:"bg-[#6B7280] text-white border-0 rounded-full",children:a})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-[#1F2937] mb-2",children:"View Results"}),e.jsx("p",{className:"text-[#6B7280]",children:"View and download compiled results for your classes"})]}),e.jsxs(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-5 border-b border-[#E5E7EB]",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ls,{className:"w-5 h-5 text-[#3B82F6]"}),e.jsx("h3",{className:"text-[#1F2937]",children:"Filters"})]})}),e.jsx(g,{className:"p-5",children:e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ns,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-[#9CA3AF]"}),e.jsx(we,{type:"text",placeholder:"Search student...",value:C,onChange:a=>h(a.target.value),className:"pl-10 rounded-lg border-[#E5E7EB] focus:border-[#3B82F6] focus:ring-[#3B82F6]"})]}),e.jsxs(je,{value:S,onValueChange:L,children:[e.jsx(be,{className:"rounded-lg border-[#E5E7EB]",children:e.jsx(Ne,{placeholder:"All Classes"})}),e.jsxs(pe,{children:[e.jsx(se,{value:"all",children:"All Classes"}),Y.map(a=>e.jsx(se,{value:a,children:a},a))]})]}),e.jsxs(je,{value:M,onValueChange:$,children:[e.jsx(be,{className:"rounded-lg border-[#E5E7EB]",children:e.jsx(Ne,{placeholder:"All Terms"})}),e.jsxs(pe,{children:[e.jsx(se,{value:"all",children:"All Terms"}),e.jsx(se,{value:"First Term",children:"First Term"}),e.jsx(se,{value:"Second Term",children:"Second Term"}),e.jsx(se,{value:"Third Term",children:"Third Term"})]})]}),e.jsxs(je,{value:ie,onValueChange:x,children:[e.jsx(be,{className:"rounded-lg border-[#E5E7EB]",children:e.jsx(Ne,{placeholder:"All Statuses"})}),e.jsxs(pe,{children:[e.jsx(se,{value:"all",children:"All Statuses"}),e.jsx(se,{value:"Draft",children:"Draft"}),e.jsx(se,{value:"Submitted",children:"Pending Approval"}),e.jsx(se,{value:"Approved",children:"Approved"}),e.jsx(se,{value:"Rejected",children:"Rejected"})]})]})]})})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-[#6B7280] text-sm",children:"Total Results"}),e.jsx(ye,{className:"w-5 h-5 text-[#3B82F6]"})]}),e.jsx("p",{className:"text-[#1F2937] font-semibold",children:U.length})]})}),e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-[#6B7280] text-sm",children:"Approved"}),e.jsx(ke,{className:"w-5 h-5 text-[#10B981]"})]}),e.jsx("p",{className:"text-[#1F2937] font-semibold",children:U.filter(a=>a.status==="Approved").length})]})}),e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-[#6B7280] text-sm",children:"Pending"}),e.jsx(Ve,{className:"w-5 h-5 text-[#F59E0B]"})]}),e.jsx("p",{className:"text-[#1F2937] font-semibold",children:U.filter(a=>a.status==="Submitted").length})]})}),e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("p",{className:"text-[#6B7280] text-sm",children:"Your Classes"}),e.jsx(ye,{className:"w-5 h-5 text-[#3B82F6]"})]}),e.jsx("p",{className:"text-[#1F2937] font-semibold",children:Y.length})]})})]}),e.jsxs(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-5 border-b border-[#E5E7EB]",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-[#1F2937]",children:"Compiled Results"}),e.jsxs(ee,{className:"bg-[#3B82F6] text-white border-0",children:[J.length," ",J.length===1?"Result":"Results"]})]})}),e.jsx(g,{className:"p-0",children:J.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ye,{className:"w-16 h-16 text-[#9CA3AF] mx-auto mb-4"}),e.jsx("h3",{className:"text-[#1F2937] mb-2",children:"No Results Found"}),e.jsx("p",{className:"text-[#6B7280] mb-4",children:U.length===0?"No results have been compiled yet.":"No results match your current filters."}),U.length>0&&e.jsx(X,{onClick:()=>{L("all"),$("all"),x("all"),h("")},className:"bg-[#3B82F6] text-white hover:bg-[#2563EB] rounded-lg",children:"Clear Filters"})]}):e.jsx("div",{className:"divide-y divide-[#E5E7EB]",children:J.map(a=>{const E=z.find(w=>w.id===a.studentId);return E?e.jsx("div",{className:"p-5 hover:bg-[#F9FAFB] transition-colors",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("h4",{className:"text-[#1F2937] font-medium",children:[E.firstName," ",E.lastName]}),s(a.status)]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-x-6 gap-y-1 text-sm text-[#6B7280]",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Admission No:"})," ",E.admissionNumber]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Class:"})," ",E.className]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Term:"})," ",a.term]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Academic Year:"})," ",a.academicYear]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Average:"})," ",e.jsxs("span",{className:"text-[#10B981] font-semibold",children:[a.averageScore.toFixed(2),"%"]})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Position:"})," ",e.jsx("span",{className:"text-[#3B82F6] font-semibold",children:a.position})]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Compiled:"})," ",new Date(a.compiledDate).toLocaleDateString()]}),a.approvedDate&&e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Approved:"})," ",new Date(a.approvedDate).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(X,{onClick:()=>F(a),variant:"outline",size:"sm",className:"rounded-lg border-[#3B82F6] text-[#3B82F6] hover:bg-[#3B82F6] hover:text-white",children:[e.jsx(as,{className:"w-4 h-4 mr-2"}),"View"]}),a.status==="Approved"&&e.jsxs(X,{onClick:()=>H(a),size:"sm",className:"bg-[#10B981] text-white hover:bg-[#059669] rounded-lg",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Print"]})]})]})},a.id):null})})})]}),q&&e.jsx(De,{open:!!q,onOpenChange:()=>D(null),children:e.jsx($e,{className:"max-w-[95vw] max-h-[95vh] p-0 overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-[#1F2937]",children:["Result Sheet - ",(o=z.find(a=>a.id===q.studentId))==null?void 0:o.firstName," ",(A=z.find(a=>a.id===q.studentId))==null?void 0:A.lastName]}),e.jsxs(X,{onClick:()=>window.print(),className:"bg-[#3B82F6] text-white hover:bg-[#2563EB] rounded-lg",children:[e.jsx(Ae,{className:"w-4 h-4 mr-2"}),"Print PDF"]})]}),e.jsx(ks,{result:q,onClose:()=>D(null)})]})})})]})}function at(){var J,F,H;const{logout:T,permissions:V}=Ns(),{currentUser:B,teachers:Z,getTeacherAssignments:le,students:z,getUnreadNotifications:ce,classes:K}=Se(),[S,L]=f.useState("dashboard"),[M,$]=f.useState(!0),[ie,x]=f.useState(null);f.useEffect(()=>{Fe(this,null,function*(){try{if($(!0),x(null),!B||B.role!=="teacher")throw new Error("Invalid teacher account or session expired");yield new Promise(o=>setTimeout(o,500))}catch(o){console.error("Error loading teacher data:",o),x((o==null?void 0:o.message)||"Failed to load teacher dashboard")}finally{$(!1)}})},[B]);const C=B?Z.find(s=>s.id===B.linkedId):null,h=(C==null?void 0:C.isClassTeacher)||!1,q=C?`${C.firstName} ${C.lastName}`:"Teacher",D=C?le(C.id):[],_=C!=null&&C.classTeacherId?K.find(s=>s.id===C.classTeacherId):null,b=D.reduce((s,o)=>(s[o.classId]||(s[o.classId]={className:o.className,subjects:[]}),s[o.classId].subjects.push(o.subjectName),s),{}),Y=B?ce(B.id,B.role):[],U=[{icon:e.jsx(ws,{className:"w-5 h-5"}),label:"Dashboard",id:"dashboard"},{icon:e.jsx(Be,{className:"w-5 h-5"}),label:"Class List",id:"class-list"},...V.canEnterScores?[{icon:e.jsx(We,{className:"w-5 h-5"}),label:"Enter Scores",id:"enter-scores"}]:[],...h?[{icon:e.jsx(is,{className:"w-5 h-5"}),label:"Compile Results",id:"compile-results"},{icon:e.jsx(_e,{className:"w-5 h-5"}),label:"Affective & Psychomotor",id:"affective-psychomotor"}]:[],...V.canViewReports?[{icon:e.jsx(ye,{className:"w-5 h-5"}),label:"View Results",id:"view-results"}]:[],{icon:e.jsx(Ze,{className:"w-5 h-5"}),label:"Notifications",id:"notifications"},{icon:e.jsx(Re,{className:"w-5 h-5"}),label:"Change Password",id:"change-password"},{icon:e.jsx(Es,{className:"w-5 h-5"}),label:"Logout",id:"logout"}].filter(Boolean),O=s=>{s==="logout"?T():L(s)};return e.jsxs("div",{className:"min-h-screen bg-[#F4F6F9]",children:[e.jsx(ys,{items:U,activeItem:S,onItemClick:O}),e.jsxs("div",{className:"lg:pl-64",children:[e.jsx(Bs,{userName:q,userRole:h?"Class Teacher":"Subject Teacher",notificationCount:Y.length,onLogout:T,onNotificationClick:()=>L("notifications")}),e.jsxs("main",{className:"p-4 md:p-6 max-w-7xl mx-auto",children:[S==="dashboard"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("h1",{className:"text-[#1F2937] mb-2",children:["Welcome back, ",q]}),e.jsx("p",{className:"text-[#6B7280]",children:h?`You have Class Teacher privileges for ${(_==null?void 0:_.name)||"your assigned class"} with additional responsibilities.`:"You are assigned as a Subject Teacher. Enter scores for your assigned subjects across different classes."}),e.jsxs("div",{className:"flex items-center gap-2 mt-2 text-xs text-[#10B981]",children:[e.jsx(ve,{className:"w-3 h-3"}),e.jsxs("span",{children:["Optimized data loading - ",z.length," relevant students loaded"]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-2 gap-6",children:[e.jsxs(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"border-b border-[#E5E7EB] p-5",children:e.jsxs("h3",{className:"text-[#1F2937] font-semibold flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-[#F59E0B]"}),"My Responsibilities"]})}),e.jsxs(g,{className:"p-5 space-y-3",children:[h&&_&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-[#DBEAFE] rounded-lg border border-[#3B82F6]/20",children:[e.jsx(Be,{className:"w-5 h-5 text-[#3B82F6]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[#1F2937] font-medium text-sm",children:"Class Teacher"}),e.jsxs("p",{className:"text-[#6B7280] text-xs",children:[_.name,"  Manage class activities, compile results, student assessments"]})]}),e.jsx(ee,{className:"bg-[#3B82F6] text-white border-0 text-xs",children:"Active"})]}),Object.values(b).map((s,o)=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-[#FEF3C7] rounded-lg border border-[#F59E0B]/20",children:[e.jsx(Te,{className:"w-5 h-5 text-[#F59E0B]"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[#1F2937] font-medium text-sm",children:"Subject Teacher"}),e.jsxs("p",{className:"text-[#6B7280] text-xs",children:[s.className,"  ",s.subjects.join(", ")]})]}),e.jsxs(ee,{className:"bg-[#F59E0B] text-white border-0 text-xs",children:[s.subjects.length," ",s.subjects.length===1?"Subject":"Subjects"]})]},o)),!h&&Object.keys(b).length===0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx(ke,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-3"}),e.jsx("p",{className:"text-[#6B7280]",children:"No assignments yet"}),e.jsx("p",{className:"text-[#9CA3AF] text-sm mt-1",children:"Contact administrator to get assigned subjects and/or classes"})]})]})]}),e.jsxs(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"border-b border-[#E5E7EB] p-5",children:e.jsxs("h3",{className:"text-[#1F2937] font-semibold flex items-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5 text-[#3B82F6]"}),"Current Assignments"]})}),e.jsxs(g,{className:"p-5 space-y-3",children:[D.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Ve,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-3"}),e.jsx("p",{className:"text-[#6B7280]",children:"No assignments yet"}),e.jsx("p",{className:"text-[#9CA3AF] text-sm mt-1",children:"Contact administrator to get assigned"})]}):D.slice(0,3).map(s=>{const o=z.filter(w=>w.classId===s.classId&&w.status==="Active"),A=o.length,a=o.filter(w=>w.gender==="Male").length,E=o.filter(w=>w.gender==="Female").length;return e.jsxs("div",{className:"flex items-center justify-between p-3 bg-[#F9FAFB] rounded-lg border border-[#E5E7EB] hover:border-[#3B82F6] transition-all",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[#1F2937] font-medium text-sm",children:s.className}),e.jsx("p",{className:"text-[#6B7280] text-xs",children:s.subjectName}),e.jsxs("div",{className:"flex items-center gap-4 mt-1",children:[e.jsxs("span",{className:"text-[#6B7280] text-xs",children:[A," students"]}),e.jsxs("span",{className:"text-[#3B82F6] text-xs",children:[a," male"]}),e.jsxs("span",{className:"text-[#EC4899] text-xs",children:[E," female"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"bg-[#10B981] text-white border-0 text-xs",children:"Active"}),A>0&&e.jsx("div",{className:"w-2 h-2 bg-[#10B981] rounded-full",title:"Students available"})]})]},s.id)}),D.length>3&&e.jsxs("p",{className:"text-center text-[#6B7280] text-sm",children:["+",D.length-3," more assignments"]})]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-4 gap-4",children:[e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical hover:shadow-clinical-lg transition-all hover-lift group",children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-[#6B7280] text-sm",children:"Role"}),e.jsx(_e,{className:"w-5 h-5 text-[#F59E0B] group-hover:scale-110 transition-transform"})]}),e.jsx("p",{className:"text-[#1F2937] mb-1 font-medium",children:h?"Class Teacher":"Subject Teacher"}),e.jsx(ee,{className:h?"bg-[#F59E0B] text-white border-0 text-xs":"bg-[#3B82F6] text-white border-0 text-xs",children:h?"Full Access":"Score Entry"})]})}),e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical hover:shadow-clinical-lg transition-all hover-lift group cursor-pointer",onClick:()=>L("enter-scores"),children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-[#6B7280] text-sm",children:"Classes Assigned"}),e.jsx(Te,{className:"w-5 h-5 text-[#3B82F6] group-hover:scale-110 transition-transform"})]}),e.jsx("p",{className:"text-[#1F2937] mb-1 font-semibold",children:D.length}),e.jsx("p",{className:"text-xs text-[#6B7280]",children:"Active classes"})]})}),e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical hover:shadow-clinical-lg transition-all hover-lift group cursor-pointer",onClick:()=>L("class-list"),children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-[#6B7280] text-sm",children:"Total Students"}),e.jsx(Be,{className:"w-5 h-5 text-[#3B82F6] group-hover:scale-110 transition-transform"})]}),e.jsx("p",{className:"text-[#1F2937] mb-1 font-semibold",children:z.filter(s=>s.status==="Active").length}),e.jsx("p",{className:"text-xs text-[#6B7280]",children:"Across all classes"})]})}),e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical hover:shadow-clinical-lg transition-all hover-lift group cursor-pointer",onClick:()=>L("notifications"),children:e.jsxs(g,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("p",{className:"text-[#6B7280] text-sm",children:"Notifications"}),e.jsx(Ze,{className:"w-5 h-5 text-[#F59E0B] group-hover:scale-110 transition-transform"})]}),e.jsx("p",{className:"text-[#1F2937] mb-1 font-semibold",children:Y.length}),e.jsx("p",{className:"text-xs text-[#F59E0B]",children:Y.length>0?"Unread messages":"All caught up"})]})})]}),h?e.jsx(p,{className:"rounded-lg bg-gradient-to-r from-[#F59E0B]/10 to-[#F59E0B]/5 border border-[#F59E0B]/20",children:e.jsx(g,{className:"p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(_e,{className:"w-6 h-6 text-[#F59E0B] mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[#1F2937] font-medium mb-2",children:"Class Teacher Workflow"}),e.jsxs("ol",{className:"text-sm text-[#6B7280] space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Enter scores for subjects you teach (CA1, CA2, Exam)"}),e.jsx("li",{children:"Review and verify all subject teacher submissions for your class"}),e.jsx("li",{children:"Enter Affective & Psychomotor assessments for each student"}),e.jsx("li",{children:"Add class teacher comments on student performance"}),e.jsx("li",{children:"Compile and submit results to Admin for approval"})]})]})]})})}):e.jsx(p,{className:"rounded-lg bg-gradient-to-r from-[#3B82F6]/10 to-[#3B82F6]/5 border border-[#3B82F6]/20",children:e.jsx(g,{className:"p-5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Te,{className:"w-6 h-6 text-[#3B82F6] mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[#1F2937] font-medium mb-2",children:"Subject Teacher Workflow"}),e.jsxs("ol",{className:"text-sm text-[#6B7280] space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Select your assigned class and subject"}),e.jsx("li",{children:"Enter CA1 (20 marks), CA2 (20 marks), and Exam (60 marks) for each student"}),e.jsx("li",{children:"Scores are auto-calculated with total, grade, and remark"}),e.jsx("li",{children:"Submit scores to the Class Teacher for final compilation"}),e.jsx("li",{children:"Class Teacher will compile all subjects and submit for approval"})]})]})]})})}),e.jsxs(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical",children:[e.jsx(oe,{className:"p-5 border-b border-[#E5E7EB]",children:e.jsx("h3",{className:"text-[#1F2937]",children:"Your Classes"})}),e.jsx(g,{className:"space-y-3 p-5 pt-5",children:D.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(Te,{className:"w-12 h-12 text-[#9CA3AF] mx-auto mb-3"}),e.jsx("p",{className:"text-[#6B7280]",children:"No class assignments yet"})]}):D.map(s=>{const o=z.filter(A=>A.classId===s.classId&&A.status==="Active");return e.jsxs("div",{className:"flex items-center justify-between p-4 bg-[#F9FAFB] rounded-lg border border-[#E5E7EB] hover:border-[#3B82F6] hover:shadow-clinical transition-all",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-[#1F2937] font-medium",children:[s.className," - ",s.subjectName]}),e.jsxs("p",{className:"text-[#6B7280] text-sm",children:[o.length," students"]})]}),e.jsx(X,{onClick:()=>{L("enter-scores")},className:"bg-[#3B82F6] text-white hover:bg-[#2563EB] rounded-lg shadow-clinical hover:shadow-clinical-lg transition-all",children:"Enter Scores"})]},s.id)})})]})]}),S==="class-list"&&e.jsx(Ls,{}),S==="enter-scores"&&e.jsx(Ms,{}),S==="compile-results"&&e.jsx(Os,{}),S==="affective-psychomotor"&&e.jsx(Ps,{}),S==="view-results"&&e.jsx(_s,{}),S==="notifications"&&e.jsx(Ss,{}),S==="change-password"&&e.jsx(Is,{}),!["dashboard","class-list","enter-scores","compile-results","affective-psychomotor","view-results","notifications","change-password"].includes(S)&&e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx(p,{className:"rounded-lg bg-white border border-[#E5E7EB] shadow-clinical max-w-md w-full",children:e.jsxs(g,{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-[#3B82F6] flex items-center justify-center mx-auto mb-4 text-white",children:(J=U.find(s=>s.id===S))==null?void 0:J.icon}),e.jsx("h3",{className:"text-[#1F2937] mb-3",children:(F=U.find(s=>s.id===S))==null?void 0:F.label}),e.jsxs("p",{className:"text-[#6B7280]",children:["This section contains the functionality for ",(H=U.find(s=>s.id===S))==null?void 0:H.label.toLowerCase(),"."]})]})})})})]})]})]})}export{at as TeacherDashboard};
